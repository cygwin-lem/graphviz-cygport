--- origsrc/graphviz-2.20.2/configure.ac	2008-08-26 03:06:58.843094700 -0500
+++ src/graphviz-2.20.2/configure.ac	2008-08-26 03:11:14.968094700 -0500
@@ -607,7 +607,7 @@
 	  use_guile="No (guile is too old)"
         else
           GUILE_INCLUDES=
-          GUILE_LIBS=
+          GUILE_LIBS=-lguile
           AC_CHECK_HEADER(libguile.h,,[
             use_guile="No (guile header missing)"
             GUILE=
@@ -865,8 +865,8 @@
         use_ocaml="No (ocaml not available)"
       else
         AC_CHECK_PROG(OCAML_OPT,ocamlopt,ocamlopt)
-        OCAML_INCLUDES=-I/usr/lib$LIBPOSTFIX/ocaml
-        OCAML_LIBS=-L/usr/lib$LIBPOSTFIX/ocaml
+        OCAML_INCLUDES="-I`$OCAML_OPT -where`"
+        OCAML_LIBS="-L`$OCAML_OPT -where` -lcamlrun"
         save_CPPFLAGS=$CPPFLAGS
         CPPFLAGS="$CPPFLAGS $OCAML_INCLUDES"
         AC_CHECK_HEADER(caml/mlvalues.h,[
@@ -960,7 +960,7 @@
         fi
         PHP_INSTALL_DIR="/usr/lib${LIBPOSTFIX}/php/modules"
         PHP_INSTALL_DATADIR="/usr/share/php"
-        PHP_LIBS=
+        PHP_LIBS=-lphp5lib
         save_CPPFLAGS=$CPPFLAGS
         CPPFLAGS="$CPPFLAGS $PHP_INCLUDES"
         AC_CHECK_HEADER(php.h,,[
@@ -1024,7 +1024,7 @@
       else
         PYTHON_PREFIX=`$PYTHON -c "import sys; print sys.prefix"`
         PYTHON_INCLUDES=-I$PYTHON_PREFIX/include/python$PYTHON_VERSION_SHORT
-        PYTHON_LIBS="-L$PYTHON_PREFIX/lib$LIBPOSTFIX/python$PYTHON_VERSION_SHORT/config"
+        PYTHON_LIBS="-L$PYTHON_PREFIX/lib$LIBPOSTFIX/python$PYTHON_VERSION_SHORT/config -lpython$PYTHON_VERSION_SHORT"
         PYTHON_INSTALL_DIR="`$PYTHON $srcdir/config/config_python.py archsitelib`"
         save_CPPFLAGS=$CPPFLAGS
         CPPFLAGS="$CPPFLAGS $PYTHON_INCLUDES"
@@ -1398,7 +1398,6 @@
   # TCL STUBS support is required
   if test "x${TCL_SUPPORTS_STUBS}" = "x1"; then
     use_tcl="Yes"
-    TCL_CFLAGS="${TCL_CFLAGS} -DUSE_TCL_STUBS"
   else
     AC_MSG_WARN([Tcl does not have STUBs support, perhaps it is too old?  The Tcl packages will not be built])
     use_tcl="No (no STUBs support)"
@@ -1448,7 +1438,7 @@
 #AC_SUBST(TCL_RANLIB)
 #AC_SUBST(TCL_LIB_FLAG)
 #AC_SUBST(TCL_BUILD_LIB_SPEC)
-#AC_SUBST(TCL_LIB_SPEC)
+AC_SUBST(TCL_LIB_SPEC)
 #AC_SUBST(TCL_LIB_VERSIONS_OK)
 #AC_SUBST(TCL_SHARED_LIB_SUFFIX)
 #AC_SUBST(TCL_UNSHARED_LIB_SUFFIX)
@@ -1556,10 +1546,6 @@
 fi
 AM_CONDITIONAL(WITH_TK, [test "x$use_tk" = "xYes"])
 
-# NB. No TK_SUPPORTS_STUBS set by tkConfig.sh
-if test "${TCL_SUPPORTS_STUBS}" = "1"; then
-    TK_CFLAGS="${TK_CFLAGS} -DUSE_TK_STUBS"
-fi
 
 AC_SUBST(TK_VERSION)
 AC_SUBST(TK_MAJOR_VERSION)
--- origsrc/graphviz-2.20.2/tclpkg/gdtclft/Makefile.am	2008-01-09 13:34:48.000000000 -0600
+++ src/graphviz-2.20.2/tclpkg/gdtclft/Makefile.am	2008-08-26 03:14:49.249344700 -0500
@@ -28,7 +28,7 @@
 
 libgdtclft_la_SOURCES = gdtclft.c
 
-libgdtclft_la_LDFLAGS = -no-undefined
+libgdtclft_la_LDFLAGS = -module -avoid-version -no-undefined
 
 if WITH_LIBGD
 if WITH_MYLIBGD
--- origsrc/graphviz-2.20.2/tclpkg/gv/Makefile.am	2008-04-29 13:19:41.000000000 -0500
+++ src/graphviz-2.20.2/tclpkg/gv/Makefile.am	2008-08-26 03:14:30.030594700 -0500
@@ -13,7 +13,6 @@
 	-I$(top_srcdir)/lib/cdt \
 	-I$(top_srcdir)/lib/pathplan
 
-LIBS =  @LIBS@ -lc
 
 BASESOURCES = gv.cpp gv.i
 BASELIBS = $(top_builddir)/lib/gvc/libgvc.la \
@@ -25,7 +24,7 @@
 nodist_libgv_sharp_la_SOURCES = gv_sharp.cpp $(SHARP_data)
 libgv_sharp_la_SOURCES = $(BASESOURCES) gv_dummy_init.cpp
 libgv_sharp_la_LIBADD = $(BASELIBS) $(SHARP_LIBS) 
-libgv_sharp_la_LDFLAGS = -module -avoid-version
+libgv_sharp_la_LDFLAGS = -module -avoid-version -no-undefined
 libgv_sharp_la_CPPFLAGS = $(AM_CPPFLAGS) $(SHARP_INCLUDES)
 $(SHARP_data): gv_sharp.cpp
 gv_sharp.cpp: gv.i
@@ -36,7 +35,7 @@
 nodist_libgv_guile_la_SOURCES = gv_guile.cpp $(GUILE_data)
 libgv_guile_la_SOURCES = $(BASESOURCES) gv_dummy_init.cpp
 libgv_guile_la_LIBADD = $(BASELIBS) $(GUILE_LIBS)
-libgv_guile_la_LDFLAGS = -module -avoid-version
+libgv_guile_la_LDFLAGS = -module -avoid-version -no-undefined
 libgv_guile_la_CPPFLAGS = $(AM_CPPFLAGS) $(GUILE_INCLUDES)
 $(GUILE_data): gv_guile.cpp
 gv_guile.cpp: gv.i
@@ -60,7 +59,7 @@
 nodist_libgv_java_la_SOURCES = gv_java.cpp
 libgv_java_la_SOURCES = $(BASESOURCES)  gv_dummy_init.cpp
 libgv_java_la_LIBADD = $(BASELIBS) $(JAVA_LIBS)
-libgv_java_la_LDFLAGS = -module -avoid-version
+libgv_java_la_LDFLAGS = -module -avoid-version -no-undefined
 libgv_java_la_CPPFLAGS = $(AM_CPPFLAGS) $(JAVA_INCLUDES)
 $(JAVA_data): gv_java.cpp
 gv_java.cpp: gv.i
@@ -71,7 +70,7 @@
 nodist_libgv_lua_la_SOURCES = gv_lua.cpp $(LUA_data)
 libgv_lua_la_SOURCES = $(BASESOURCES) gv_dummy_init.cpp
 libgv_lua_la_LIBADD = $(BASELIBS) $(LUA_LIBS)
-libgv_lua_la_LDFLAGS = -module -avoid-version
+libgv_lua_la_LDFLAGS = -module -avoid-version -no-undefined
 libgv_lua_la_CPPFLAGS = $(AM_CPPFLAGS) $(LUA_INCLUDES)
 $(LUA_data): gv_lua.cpp
 gv_lua.cpp: gv.i
@@ -85,7 +84,7 @@
 nodist_libgv_ocaml_la_SOURCES = gv_ocaml.cpp $(OCAML_data)
 libgv_ocaml_la_SOURCES = $(BASESOURCES) gv_dummy_init.cpp
 libgv_ocaml_la_LIBADD = $(BASELIBS) @OCAML_LIBS@
-libgv_ocaml_la_LDFLAGS = -module -avoid-version
+libgv_ocaml_la_LDFLAGS = -module -avoid-version -no-undefined
 libgv_ocaml_la_CPPFLAGS = $(AM_CPPFLAGS) $(OCAML_INCLUDES)
 gv.ml gv.mli: gv_ocaml.cpp
 gv_ocaml.cpp: gv.i
@@ -115,7 +114,7 @@
 nodist_libgv_perl_la_SOURCES = gv_perl.cpp $(PERL_data)
 libgv_perl_la_SOURCES = $(BASESOURCES) gv_dummy_init.cpp
 libgv_perl_la_LIBADD = $(BASELIBS) $(PERL_LIBS)
-libgv_perl_la_LDFLAGS = -module -avoid-version
+libgv_perl_la_LDFLAGS = -module -avoid-version -no-undefined
 libgv_perl_la_CPPFLAGS = $(AM_CPPFLAGS) $(PERL_INCLUDES)
 $(PERL_data): gv_perl.cpp
 gv_perl.cpp: gv.i
@@ -126,7 +125,7 @@
 nodist_libgv_php_la_SOURCES = gv_php.cpp php_gv.h
 libgv_php_la_SOURCES = $(BASESOURCES) gv_php_init.cpp
 libgv_php_la_LIBADD = $(BASELIBS) $(PHP_LIBS)
-libgv_php_la_LDFLAGS = -module -avoid-version
+libgv_php_la_LDFLAGS = -module -avoid-version -no-undefined
 libgv_php_la_CPPFLAGS = $(AM_CPPFLAGS) $(PHP_INCLUDES)
 gv.php: gv_php.cpp
 php_gv.h: gv_php.cpp
@@ -138,7 +137,7 @@
 nodist_libgv_python_la_SOURCES = gv_python.cpp $(PYTHON_data)
 libgv_python_la_SOURCES = $(BASESOURCES) gv_dummy_init.cpp
 libgv_python_la_LIBADD = $(BASELIBS) $(PYTHON_LIBS)
-libgv_python_la_LDFLAGS = -module -avoid-version
+libgv_python_la_LDFLAGS = -module -avoid-version -no-undefined
 libgv_python_la_CPPFLAGS = $(AM_CPPFLAGS) $(PYTHON_INCLUDES)
 $(PYTHON_data): gv_python.cpp
 gv_python.cpp: gv.i
@@ -181,7 +180,7 @@
 nodist_libgv_ruby_la_SOURCES = gv_ruby.cpp $(RUBY_data)
 libgv_ruby_la_SOURCES = $(BASESOURCES) gv_dummy_init.cpp
 libgv_ruby_la_LIBADD = $(BASELIBS) $(RUBY_LIBS)
-libgv_ruby_la_LDFLAGS = -module -avoid-version
+libgv_ruby_la_LDFLAGS = -module -avoid-version -no-undefined
 libgv_ruby_la_CPPFLAGS = $(AM_CPPFLAGS) $(RUBY_INCLUDES)
 $(RUBY_data): gv_ruby.cpp
 gv_ruby.cpp: gv.i
@@ -192,7 +191,7 @@
 nodist_libgv_tcl_la_SOURCES = gv_tcl.cpp $(TCL_data)
 libgv_tcl_la_SOURCES = $(BASESOURCES) gv_dummy_init.cpp
 libgv_tcl_la_LIBADD = $(top_builddir)/tclpkg/tclstubs/libtclstubs_C.la $(BASELIBS) $(TCL_LIBS)
-libgv_tcl_la_LDFLAGS = -module -avoid-version
+libgv_tcl_la_LDFLAGS = -module -avoid-version -no-undefined
 libgv_tcl_la_CPPFLAGS = $(AM_CPPFLAGS) $(TCL_INCLUDES)
 $(TCL_data): gv_tcl.cpp
 gv_tcl.cpp: gv.i
--- origsrc/graphviz-2.20.2/tclpkg/tcldot/Makefile.am	2008-05-23 00:08:35.000000000 -0500
+++ src/graphviz-2.20.2/tclpkg/tcldot/Makefile.am	2008-08-26 03:14:49.264969700 -0500
@@ -43,10 +43,12 @@
 endif
 
 libtcldot_la_SOURCES = tcldot.c $(CODEGENS) $(GDTCLFT)
-libtcldot_la_LDFLAGS = -no-undefined 
+libtcldot_la_LDFLAGS = -module -avoid-version -no-undefined 
 
 libtcldot_la_LIBADD = $(top_builddir)/tclpkg/tclhandle/libtclhandle_C.la \
 	$(top_builddir)/tclpkg/tclstubs/libtclstubs_C.la \
+	$(top_builddir)/lib/graph/libgraph.la \
+	$(top_builddir)/lib/cdt/libcdt.la \
 	$(top_builddir)/lib/gvc/libgvc.la 
 
 # GDTCLFT requires gd libs to be builtin
@@ -65,7 +67,7 @@
 	tcldot.c $(CODEGENS) $(GDTCLFT) \
 	$(top_srcdir)/lib/gvc/dot_builtins.c \
 	$(top_srcdir)/lib/gvc/no_demand_loading.c 
-libtcldot_builtin_la_LDFLAGS =
+libtcldot_builtin_la_LDFLAGS = -module -avoid-version -no-undefined
 
 libtcldot_builtin_la_LIBADD = \
 	$(top_builddir)/tclpkg/tclhandle/libtclhandle_C.la \
--- origsrc/graphviz-2.20.2/tclpkg/tclpathplan/Makefile.am	2008-01-09 13:34:49.000000000 -0600
+++ src/graphviz-2.20.2/tclpkg/tclpathplan/Makefile.am	2008-08-26 03:14:49.280594700 -0500
@@ -18,7 +18,7 @@
 endif
 
 libtclplan_la_SOURCES = find_ints.c intersect.c makecw.c tclpathplan.c wrapper.c
-libtclplan_la_LDFLAGS = -no-undefined
+libtclplan_la_LDFLAGS = -module -avoid-version -no-undefined
 libtclplan_la_LIBADD = \
 	$(top_builddir)/tclpkg/tclhandle/libtclhandle_C.la \
 	$(top_builddir)/tclpkg/tclstubs/libtclstubs_C.la \
--- origsrc/graphviz-2.20.2/tclpkg/tclstubs/Makefile.am	2006-05-26 09:49:11.000000000 -0500
+++ src/graphviz-2.20.2/tclpkg/tclstubs/Makefile.am	2008-08-26 03:14:49.280594700 -0500
@@ -3,7 +3,7 @@
 
 AM_CPPFLAGS = @TCL_CFLAGS@ @TCL_INCLUDES@
 
-LIBS = @TCL_STUB_LIB_SPEC@
+LIBS = @TCL_LIB_SPEC@
 
 if WITH_TCL
 noinst_LTLIBRARIES = libtclstubs_C.la
--- origsrc/graphviz-2.20.2/tclpkg/tkspline/Makefile.am	2008-01-09 13:34:49.000000000 -0600
+++ src/graphviz-2.20.2/tclpkg/tkspline/Makefile.am	2008-08-26 03:14:49.311844700 -0500
@@ -25,7 +25,7 @@
 pdf_DATA = $(pdf)
 endif
 
-libtkspline_la_LDFLAGS = -no-undefined 
+libtkspline_la_LDFLAGS = -module -avoid-version -no-undefined 
 libtkspline_la_SOURCES = tkspline.c
 libtkspline_la_LIBADD = \
 	$(top_builddir)/tclpkg/tkstubs/libtkstubs_C.la \
--- origsrc/graphviz-2.20.2/tclpkg/tkstubs/Makefile.am	2006-05-26 09:49:11.000000000 -0500
+++ src/graphviz-2.20.2/tclpkg/tkstubs/Makefile.am	2008-08-26 03:14:49.327469700 -0500
@@ -3,7 +3,7 @@
 
 AM_CPPFLAGS = @TCL_CFLAGS@ @TK_CFLAGS@ @TCL_INCLUDES@  @TK_INCLUDES@ @TK_XINCLUDES@
                                                                                 
-LIBS = @TK_STUB_LIB_SPEC@
+LIBS = @TK_LIB_SPEC@
 
 if WITH_TK
 noinst_LTLIBRARIES = libtkstubs_C.la
